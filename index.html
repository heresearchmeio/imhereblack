<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImHere-Black | 프리미엄 기사 파트너</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;900&display=swap');
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: #000000;
            color: #f1f5f9;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .logo-container {
            position: relative;
            background: rgba(255, 255, 255, 0.15); /* 로고 가시성 확보 */
            padding: 4px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            display: flex; align-items: center; justify-content: center;
        }
        .logo-img { width: 34px; height: 34px; object-fit: contain; }

        /* 입력 폼 스타일링 */
        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }
        .input-field:focus {
            border-color: #10b981;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="sticky top-0 z-50 glass-card border-b border-white/10 px-4 py-3">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div onclick="showTab('home')" class="flex items-center gap-3 cursor-pointer group">
                <div class="logo-container">
                    <img src="imhereblack.jpg" alt="Logo" class="logo-img" onerror="this.src='https://via.placeholder.com/34/333/fff?text=IM'">
                </div>
                <span class="text-xl font-black tracking-tighter text-white">ImHere-Black</span>
            </div>
            
            <div class="flex items-center gap-1 md:gap-2">
                
                <button onclick="showTab('schedule')" class="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-white/10 transition-all">
                    <i data-lucide="truck" class="w-4 h-4 text-emerald-400"></i>
                    <span class="text-sm font-bold hidden sm:inline">배차현황</span>
                </button>
                <button onclick="showTab('register')" class="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-white/10 transition-all border border-white/5">
                    <i data-lucide="user-plus" class="w-4 h-4 text-emerald-500"></i>
                    <span class="text-sm font-bold hidden sm:inline text-emerald-500">기사등록</span>
                </button>
                <button onclick="showTab('notice')" class="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-white/10 transition-all">
                    <i data-lucide="bell-ring" class="w-4 h-4 text-amber-400"></i>
                    <span class="text-sm font-bold hidden sm:inline">알림</span>
                </button>
                <button onclick="showTab('about')" class="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-white/10 transition-all">
                    <!-- <i data-lucide="layout-dashboard" class="w-4 h-4 text-blue-400"></i> -->
                    <i data-lucide="building" class="w-4 h-4 text-blue-400"></i>
                    <span class="text-sm font-bold hidden sm:inline">회사소개</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6 w-full flex-grow">

        <div id="home" class="tab-content active space-y-6">
            <div class="glass-card rounded-[2rem] p-8 md:p-12 border-l-4 border-emerald-500 overflow-hidden relative">
                <div class="relative z-10">
                    <span class="bg-emerald-500/20 text-emerald-400 text-xs font-bold px-3 py-1 rounded-full mb-4 inline-block">24/7 전문 기사 서비스</span>
                    <h2 class="text-3xl md:text-4xl font-black mb-4 leading-tight">
                        멈춰있는 시간을<br>안전한 이동으로 연결합니다.
                    </h2>
                    <p class="text-gray-400 text-base md:text-lg max-w-2xl mb-8 leading-relaxed">
                        낮의 번잡함부터 밤의 정적까지, <span class="text-white">ImHere-Black</span>은 <br class="hidden md:block">
                        소중한 고객님과 기사님의 성실함을 가장 신뢰 있는 방식으로 잇습니다.
                    </p>
                    <div class="flex gap-4">
                        <button onclick="showTab('schedule')" class="bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-3 rounded-xl font-bold transition-all flex items-center gap-2">
                            <i data-lucide="play-circle" class="w-5 h-5"></i> 배차 현황
                        </button>
                        <button onclick="showTab('register')" class="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl font-bold transition-all flex items-center gap-2">
                             <i data-lucide="user-plus" class="w-5 h-5"></i> 기사 등록
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="glass-card rounded-2xl p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="flex items-center gap-2 font-bold text-lg"><i data-lucide="bell-ring" class="text-amber-500"></i>알림 </h3>
                        <span onclick="showTab('notice')" class="text-xs text-white-500 cursor-pointer">더보기</span>
                    </div>
                </div>           

                <div class="glass-card rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="flex items-center gap-2 font-bold text-lg"><i data-lucide="info" class="text-blue-500"></i> 블랙 브리핑</h3>
                        <span onclick="showTab('notice')" class="text-xs text-gray-500 cursor-pointer">더보기</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="register" class="tab-content">
            <div class="max-w-4xl mx-auto glass-card rounded-3xl overflow-hidden border border-emerald-500/20 shadow-2xl">
                <div class="bg-emerald-500/10 p-6 text-center border-b border-emerald-500/20">
                    <h2 class="text-2xl font-black text-white">파트너 기사 신청</h2>
                    <p class="text-sm text-gray-400 mt-1">아래 양식을 작성하여 제출해 주세요.</p>
                </div>
                
                <div class="relative w-full" style="padding-top: 150%;"> 
                    <iframe 
                        src="https://docs.google.com/forms/d/e/1FAIpQLSewqo8daGxSvz59HXkFb-MXPV8_F0gcZn6wLQ7uNJDvIjE7Wg/viewform?usp=header" 
                        class="absolute top-0 left-0 w-full h-full border-0"
                        frameborder="0" 
                        marginheight="0" 
                        marginwidth="0">
                        로드 중…
                    </iframe>
                </div>
            </div>
            <p class="text-center text-xs text-gray-500 mt-4">양식 제출 후 관리자 승인까지 최대 24시간이 소요될 수 있습니다.</p>
        </div>

        <div id="login" class="tab-content">
            <div class="max-w-md mx-auto mt-10 glass-card rounded-3xl p-10 border border-white/10 shadow-2xl">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-white/5 mb-4 border border-white/10">
                        <i data-lucide="lock" class="text-white w-8 h-8"></i>
                    </div>
                    <h2 class="text-2xl font-black text-white">ADMIN LOGIN</h2>
                    <p class="text-sm text-gray-500 mt-2">관리자 인증이 필요합니다.</p>
                </div>
                <div class="space-y-4">
                    <input type="text" placeholder="이메일" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white focus:outline-none focus:border-blue-500 transition-all">
                    <input type="password" placeholder="비밀번호" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white focus:outline-none focus:border-blue-500 transition-all">
                    <button class="w-full py-4 bg-white text-black font-black rounded-xl hover:bg-gray-200 transition-all mt-4">접속하기</button>
                </div>
                <button onclick="showTab('home')" class="w-full mt-6 text-xs text-gray-500 hover:text-white transition-colors">홈으로 돌아가기</button>
            </div>
        </div>

        <div id="about" class="tab-content">
            <div class="max-w-3xl mx-auto glass-card rounded-3xl p-8 md:p-12 text-center">
                <div class="logo-container w-20 h-20 mx-auto mb-6">
                    <img src="imhereblack.jpg" alt="Logo" class="w-full h-full object-contain rounded-lg">
                </div>
                <h2 class="text-3xl font-black mb-4">언제나 당신 곁에, ImHere-Black</h2>
                <div class="h-1 w-12 bg-emerald-500 mx-auto mb-8"></div>
                
                <div class="space-y-6 text-gray-300 text-lg leading-relaxed text-left md:text-center">
                    <p>
                        우리는 <span class="text-white font-bold">'기다림'</span>을 <span class="text-emerald-400 font-bold">'움직임'</span>으로 바꿉니다.
                    </p>
                    <p>
                        낮에는 햇살 아래 뜨거운 열정으로, 밤에는 달빛 아래 고요한 책임감으로 <br class="hidden md:block">
                        기사님들이 안전하게 대기하고 신속하게 이동할 수 있는 환경을 만듭니다.
                    </p>
                    <p>
                        고객님의 소중한 인연, <br class="hidden md:block">
                        그 신뢰가 끊기지 않도록 최고의 서비스로 보답하겠습니다.
                    </p>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-12">
                    <div class="p-4 bg-white/5 rounded-2xl">
                        <p class="text-2xl font-black text-white">24h</p>
                        <p class="text-xs text-gray-500">신속한 응대</p>
                    </div>
                    <div class="p-4 bg-white/5 rounded-2xl">
                        <p class="text-2xl font-black text-white">Safe</p>
                        <p class="text-xs text-gray-500">안전한 서비스</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="schedule" class="tab-content">
            <div class="glass-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                    <i data-lucide="calendar"></i> 배차 일정 및 신청
                </h2>
                
                <div id="calendar-auth-section" class="mb-6">
                    <p class="text-sm text-gray-400 mb-4">일정을 확인하고 신청하려면 회원 이메일(구글 gmail) 인증이 필요합니다.</p>
                    <input type="email" id="userEmail" placeholder="이메일 입력" class="input-field p-2 rounded-lg w-full max-w-xs text-sm">
                    <button onclick="verifyMember()" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-bold">인증하기</button>
                </div>

                <div id="calendar-display" class="hidden">
                    <div class="flex justify-end mb-2">
                        <button onclick="logout()" class="text-xs text-gray-500 hover:text-red-400 flex items-center gap-1">
                            <i data-lucide="log-out" class="w-3 h-3"></i> 다른 계정으로 인증
                        </button>
                    </div>
                    <div class="aspect-video w-full">
                        <iframe id="google-cal-iframe" src="" style="border: 0" width="100%" height="600" frameborder="0" scrolling="no"></iframe>
                    </div>
                    <div class="p-4 bg-emerald-500/10 rounded-xl border border-emerald-500/20">
                        <h3 class="text-sm font-bold text-white mb-2">실시간 배차 신청</h3>
                        <div class="flex gap-2">
                            <input type="text" id="applyEventId" placeholder="일정 클릭 후 나오는 주소의 ID 입력" class="input-field p-2 rounded-lg flex-grow text-xs">
                            <button onclick="applyForJob()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded-lg text-xs font-bold transition-all">
                                신청하기
                            </button>
                        </div>
                        <p class="text-[10px] text-gray-500 mt-2">* 캘린더에서 일정을 클릭하여 상세 내용을 확인하세요. 선착순 1명만 배정됩니다.</p>
                    </div>
                    <div class="mt-6 p-4 bg-white/5 rounded-xl border border-white/10">
                        <h3 class="text-sm font-bold text-emerald-400 mb-2">배정 신청 안내</h3>
                        <p class="text-xs text-gray-400">원하시는 일정을 클릭하여 상세 내용을 확인한 후, 신청하기 버튼을 눌러주세요.</p>
                        </div>
                </div>
            </div>
        </div>

<script>

</script>

        <div id="notice" class="tab-content">
            <div class="glass-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold mb-6">알림</h2>
                <div class="p-4 bg-amber-500/10 rounded-xl border border-amber-500/20">
                    <p class="text-sm font-bold text-amber-200 underline">아임히어 이용안내</p>
                    <p class="text-xs text-amber-500/80 mt-1">Gmail(구글메일)을 이용하여 '기사등록' 바랍니다.</p>
                </div>
            </div>
            <div class="glass-card rounded-2xl p-8">
                <h2 class="text-2xl font-bold mb-6">블랙 브리핑</h2>
                <div class="p-4 bg-amber-500/10 rounded-xl border border-amber-500/20">
                    <p class="text-xs text-amber-500/80 mt-1">최신 트렌드, 뉴스, 기술, 경제용어 , 제태크 정보 등 다가오는 부의 지도를 함께 그려나가요!</p>
                </div>
            </div>
        </div>

        <div id="blogger-notice-container" class="space-y-4 pt-4">
           <p class="text-center text-gray-600 text-sm py-10">최신 소식을 불러오는 중...</p>
        </div>
        
    </main>

    <footer class="p-8 text-center border-t border-white/5">
        <p class="text-gray-600 text-[10px] tracking-widest uppercase">Reliable Delivery Partner</p>
        <p><a href="mailto:heresearchmeio@gmail.com?subject=[아임히어 블랙 문의]" class="text-xs text-amber-500/80 mt-1">고객센터</a></p>
        <p class="text-gray-500 text-xs mt-2">© ImHere-Black Since 2025. All rights reserved.</p>
    </footer>

    <script>
        // 탭 전환 함수
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            const target = document.getElementById(tabId);
            if(target) {
                target.classList.add('active');
                window.scrollTo({top: 0, behavior: 'smooth'});
                
                // 알림 탭 진입 시 데이터 로드
                if(tabId === 'notice') fetchBloggerNotice();
            }
        }

        // --- 구글 블로거 연동 설정 ---
        const BLOG_NAME = 'architectstory'; // 블로그 ID
        const LABEL_NAME = 'imhere';        // 카테고리(라벨) 명

        function fetchBloggerNotice() {
            const maxPosts = 3;
            const feedUrl = `https://${BLOG_NAME}.blogspot.com/feeds/posts/default/-/${encodeURIComponent(LABEL_NAME)}?alt=json-in-script&callback=renderBloggerNotice&max-results=${maxPosts}`;
            
            const oldScript = document.getElementById('blogger-script');
            if(oldScript) oldScript.remove();

            const script = document.createElement('script');
            script.id = 'blogger-script';
            script.src = feedUrl;
            document.body.appendChild(script);
        }

        // 데이터 렌더링 함수
        function renderBloggerNotice(data) {
            const container = document.getElementById('blogger-notice-container');
            const homePreview = document.getElementById('home-notice-preview');
            const entries = data.feed.entry;

            if (!entries || entries.length === 0) {
                const emptyMsg = `<p class="text-center text-gray-600 text-xs py-10">최신 공지사항이 없습니다.</p>`;
                if(container) container.innerHTML = emptyMsg;
                return;
            }

            let fullListHtml = "";
            let previewHtml = "";

            entries.forEach((entry, index) => {
                const title = entry.title.$t;
                const link = entry.link.find(l => l.rel === 'alternate').href;
                const date = new Date(entry.published.$t).toLocaleDateString('ko-KR', {
                    year: 'numeric', month: 'short', day: 'numeric'
                });
                
                let summary = entry.summary ? entry.summary.$t : (entry.content ? entry.content.$t : "");
                summary = summary.replace(/<[^>]*>?/gm, '').substring(0, 100);

                // 전체 리스트 UI
                fullListHtml += `
                    <div onclick="window.open('${link}')" class="p-5 glass-card rounded-xl border-l-2 border-white/10 hover:border-emerald-500 transition-all cursor-pointer group">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-white group-hover:text-emerald-400 transition-colors">${title}</h4>
                            <span class="text-[10px] text-gray-500">${date}</span>
                        </div>
                        <p class="text-xs text-gray-400 leading-relaxed line-clamp-2">${summary}...</p>
                        <div class="mt-3 flex items-center gap-1 text-[10px] text-emerald-500 font-bold uppercase tracking-widest">
                            상세보기 <i data-lucide="chevron-right" class="w-3 h-3"></i>
                        </div>
                    </div>
                `;

                // 홈 화면 미리보기 (최근 2개만)
                if(index < 2) {
                    previewHtml += `
                        <div onclick="window.open('${link}')" class="flex justify-between items-center p-3 hover:bg-white/5 rounded-lg cursor-pointer transition-colors border-b border-white/5">
                            <span class="text-sm text-gray-300 truncate pr-4">${title}</span>
                            <span class="text-[10px] text-gray-600 shrink-0">${date}</span>
                        </div>
                    `;
                }
            });

            if(container) container.innerHTML = fullListHtml;
            if(homePreview) homePreview.innerHTML = previewHtml;
            lucide.createIcons();
        }

        // 초기 실행
        window.onload = () => {
            lucide.createIcons();
            fetchBloggerNotice(); // 홈 화면 미리보기를 위해 첫 로딩 시 호출
        };

        // 회원 인증 및 캘린더 노출 로직
        //배포주소
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyufrWlyL2dWbmJMDIS8f1y8HilPwTN3maiEU9nj8dqaXkHmcjqyT6mjUZZZY_gjTiYOA/exec";
       
        window.addEventListener('load', () => {
            const savedEmail = localStorage.getItem('imhere_user_email');
            if (savedEmail) {
                document.getElementById('userEmail').value = savedEmail;
                verifyMember(true); // 자동 인증 모드로 실행
            }
            lucide.createIcons();
        });

        async function verifyMember(isAuto = false) {
            const emailInput = document.getElementById('userEmail');
            const email = emailInput.value.toLowerCase().trim();
            const calIframe = document.getElementById('google-cal-iframe');
            const authSection = document.getElementById('calendar-auth-section');
            const calDisplay = document.getElementById('calendar-display');

            if (!email) {
                alert("이메일을 입력해주세요.");
                return;
            }

            try {
                const url = `${GAS_WEB_APP_URL}?action=checkAuth&email=${encodeURIComponent(email)}`;
                
                // fetch 옵션을 최소화하여 브라우저의 기본 리다이렉트 처리를 유도합니다.
                const response = await fetch(url, {
                    method: "GET",
                    mode: "cors", // No-cors를 쓰면 응답 데이터를 읽을 수 없으므로 반드시 cors 유지
                    redirect: "follow"
                });

                if (!response.ok) throw new Error('네트워크 응답 에러');

                const auth = await response.json();
                console.log("인증 성공:", auth);

                if (auth.isMember) {
                    
                    localStorage.setItem('imhere_user_email', email);

                    const calId = 'heresearchmeio@gmail.com';
                    const calUrl = `https://calendar.google.com/calendar/embed?src=${encodeURIComponent(calId)}&ctz=Asia%2FSeoul`;
                    
                    calIframe.src = calUrl;
                    authSection.classList.add('hidden');
                    calDisplay.classList.remove('hidden');
                    
                    alert(auth.isAdmin ? "관리자 권한으로 인증되었습니다." : "회원 인증 성공!");
                } else {
                    alert("등록된 회원이 아닙니다.");
                    localStorage.removeItem('imhere_user_email'); // 잘못된 정보는 삭제
                }
            } catch (error) {
                console.error("인증 실패 상세:", error);
                alert("인증 서버 통신 실패. GAS 배포 권한이 '모든 사용자(Anyone)'인지 다시 확인하세요.");
            }
        }
        function logout() {
            if (confirm("로그아웃 하시겠습니까?")) {
                localStorage.removeItem('imhere_user_email');
                location.reload(); // 새로고침하여 초기 화면으로 이동
            }
        }

        window.addEventListener('load', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const applyId = urlParams.get('apply');
            const savedEmail = localStorage.getItem('imhere_user_email');

            if (applyId) {
                    // 주소창에서 파라미터는 즉시 제거 (새로고침 시 팝업 반복 방지)
                    window.history.replaceState({}, document.title, window.location.pathname);

                    if (!savedEmail) {
                        alert("로그인이 필요합니다. 이메일 인증을 먼저 완료해 주세요.");
                        return;
                    }

                    // [핵심] 브라우저 기본 alert 대신 커스텀 팝업을 띄울 수 있습니다.
                    // 여기서는 가장 직관적인 확인 팝업을 사용합니다.
                    showApplyModal(applyId, savedEmail);
                }
                
                checkAutoLogin(); 
        });

        // 신청 확인 팝업 함수
        async function showApplyModal(eventId, email) {
            if (confirm("이 배차 일정을 신청하시겠습니까?\n확인 시 즉시 배차 마감됩니다.")) {
                try {
                    // 로딩 표시 (선택사항)
                    const response = await fetch(`${GAS_WEB_APP_URL}?action=applyAssignment&apply=${eventId}&email=${email}`);
                    const result = await response.json();
                    
                    // 결과 알림
                    alert(result.message);
                    
                    // 성공 시 캘린더 새로고침 (마감 반영)
                    if (result.success) {
                        location.reload();
                    }
                } catch (e) {
                    alert("신청 처리 중 오류가 발생했습니다.");
                }
            }
        }
    </script>
</body>
</html>
